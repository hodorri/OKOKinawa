<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>2025 OK금융그룹 리프레시 해외연수 · 오키나와</title>
  <style>
    :root{--ok-orange:#ff5a2c;--ok-sea:#5cc8ff;--ok-sky:#d6f2ff;--ink:#1c2a3a;--radius:18px}
    *{box-sizing:border-box}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial,"Apple SD Gothic Neo","Noto Sans KR",sans-serif;color:var(--ink);background:linear-gradient(180deg,var(--ok-sky),#ffffff 36%)}
    header{padding:18px 16px 8px;background:linear-gradient(180deg,var(--ok-sky),var(--ok-sea));color:#053a53;border-bottom:4px solid var(--ok-sea)}
    .wrap{max-width:1100px;margin:0 auto;padding:18px}
    .brand{display:flex;align-items:center;gap:12px}
    .brand h1{font-size:22px;margin:0}
    .sub{opacity:.85;margin-top:4px}
    .banner{position:relative;border-radius:var(--radius);overflow:hidden;margin:12px 0;box-shadow:0 10px 26px rgba(0,0,0,.07)}
    .banner img{width:100%;height:auto;display:block}
    .tabbar{display:flex;gap:8px;flex-wrap:wrap;margin:14px 0}
    .tabbar button{border:none;padding:10px 14px;border-radius:999px;background:#fff;box-shadow:0 4px 10px rgba(0,0,0,.06);cursor:pointer;font-weight:700;color:#0c3d52;border:2px solid transparent}
    .tabbar button.active{background:var(--ok-orange);color:#fff;border-color:#ff8e73}
    .card{background:#fff;border-radius:var(--radius);box-shadow:0 8px 24px rgba(0,0,0,.08);padding:18px}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:12px}
    .col-12{grid-column:span 12}.col-6{grid-column:span 6}.col-4{grid-column:span 4}
    @media (max-width:840px){.col-6,.col-4{grid-column:span 12}}
    label{font-weight:600;margin:4px 0;display:block}
    input,select,textarea{width:100%;padding:10px 12px;border:1.5px solid #d9e5ee;border-radius:12px;background:#fbfdff}
    textarea{min-height:80px;resize:vertical}
    .actions{display:flex;gap:10px;flex-wrap:wrap}
    .btn{appearance:none;border:none;padding:12px 16px;border-radius:14px;font-weight:800;cursor:pointer}
    .btn.primary{background:var(--ok-orange);color:white}.btn.secondary{background:#eef6ff;color:#094664}
    .list{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px}
    .profile-card{border:1px solid #eef2f7;border-radius:16px;padding:14px;background:#fffdf9}
    .profile-card h4{margin:0 0 8px}.pill{display:inline-block;background:#fff;border:1px dashed #ffd9c9;border-radius:999px;padding:4px 10px;font-size:12px;margin-left:6px}
    .ok-badge{position:fixed;right:18px;bottom:18px;background:#fff;border:2px solid #ffe1d9;border-radius:16px;padding:10px;display:flex;align-items:center;gap:8px;box-shadow:0 8px 24px rgba(0,0,0,.12)}
    .ok-badge img{height:42px}
    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:22px;background:#102a43;color:#fff;padding:12px 16px;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,.2);display:none}
    .help{font-size:12px;color:#6b7a89;margin:4px 0 12px}
    .debug{display:none;margin-top:8px;padding:10px;border-radius:12px;background:#f7fbff;border:1px solid #e3eef9;font-family:ui-monospace,Consolas,monospace;font-size:12px;white-space:pre-wrap}
    .debug-toggle{cursor:pointer;font-size:12px;color:#0b5cab;text-decoration:underline;margin-left:6px}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="brand">
        <div>
          <h1>2025 OK금융그룹 리프레시 해외연수 · 오키나와</h1>
          <div class="sub">자기소개서 제출 · 조회
            <span class="debug-toggle" id="toggleDebug">[디버그 보기]</span>
          </div>
        </div>
      </div>
      <div class="banner">
        <!-- ✅ 배너: 영문 파일 우선, 실패 시 한글 파일명/폴더로 폴백 -->
        <img id="bannerImg" src="okinawa-1.jpg" alt="오키나와 배경"
             onerror="this.onerror=null;
                      this.src='오키나와%20읏맨.JPG';
                      this.onerror=function(){ this.src='images/okinawa-1.jpg'; }">
      </div>
      <div class="tabbar">
        <button class="active" data-tab="tab-submit">① 자기소개 입력</button>
        <button data-tab="tab-list">② 제출 내역 조회</button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <!-- SUBMIT -->
    <section id="tab-submit" class="card">
      <h2>자기소개 입력</h2>
      <p class="help">모든 항목은 행사 운영을 위한 용도로만 사용됩니다.</p>
      <form id="introForm" class="grid" autocomplete="on">
        <div class="col-6"><label>편성 조</label><input name="편성 조" required placeholder="예: 7"></div>
        <div class="col-6"><label>이름</label><input name="이름" required placeholder="홍길동"></div>
        <div class="col-12"><label>소속 팀/센터/지점</label><input name="소속 팀/센터/지점" placeholder="예: 디지털금융팀"></div>
        <div class="col-4"><label>나이</label><input name="나이" type="number" min="18" max="99" placeholder="33"></div>
        <div class="col-8"><label>고향/사는 곳</label><input name="고향/사는 곳" placeholder="서울 / 일산"></div>
        <div class="col-4"><label>MBTI</label><input name="MBTI" placeholder="ENFP"></div>
        <div class="col-4"><label>음주량(소주기준)</label>
          <select name="음주량(소주기준)">
            <option>마시지 않음</option><option>반병</option><option>1병</option><option>1.5병</option><option>2병 이상</option>
          </select>
        </div>
        <div class="col-4"><label>흡연 여부</label>
          <select name="흡연 여부"><option>비흡연</option><option>흡연</option></select>
        </div>
        <div class="col-12"><label>요즘 관심사</label><input name="요즘 관심사" placeholder="예: 게임, 러닝, 사진"></div>
        <div class="col-12"><label>취미</label><input name="취미" placeholder="예: 볼링"></div>
        <div class="col-12"><label>근래 슬펐던 일</label><textarea name="근래 슬펐던 일"></textarea></div>
        <div class="col-12"><label>근래 기뻤던 일</label><textarea name="근래 기뻤던 일"></textarea></div>
        <div class="col-6"><label>성격 장점</label><input name="성격 장점" placeholder="무던하고 털털함"></div>
        <div class="col-6"><label>성격 단점</label><input name="성격 단점" placeholder="가끔 급함"></div>
        <div class="col-12"><label>조원들에게 약속</label><input name="조원들에게 약속" placeholder="시간 약속 준수"></div>
        <div class="col-12 actions">
          <button class="btn primary" type="submit">제출하기</button>
          <button class="btn secondary" type="reset">초기화</button>
        </div>
      </form>
      <div class="debug" id="debugBox"></div>
    </section>

    <!-- LIST -->
    <section id="tab-list" class="card" hidden>
      <h2>제출 내역 조회</h2>
      <div class="grid" style="margin:10px 0 16px">
        <div class="col-4"><label>조 선택</label><input id="filterTeam" placeholder="예: 7"></div>
        <div class="col-4"><label>이름 검색</label><input id="filterName" placeholder="예: 김아름"></div>
        <div class="col-4"><label>&nbsp;</label><button id="btnRefresh" class="btn secondary" style="width:100%">전체 불러오기</button></div>
      </div>
      <div id="list" class="list"></div>
    </section>
  </main>

  <!-- 하단 배지: 폴백 체인 -->
  <div class="ok-badge">
    <img id="badgeImg" src="okinawa-2.jpg" alt="읏맨"
         onerror="this.onerror=null;
                  this.src='오키나와%20읏맨2.JPG';
                  this.onerror=function(){ this.src='images/okinawa-2.jpg'; }">
    <div>
      <div style="font-weight:800;color:#ff5a2c">WELCOME TO OKINAWA</div>
      <small>바다처럼 텐션↑ ㅋㅋ</small>
    </div>
  </div>
  <div class="toast" id="toast"></div>

  <script>
    // ✅ Apps Script Web App URL (서누콩 배포 URL)
    const GAS_URL = "https://script.google.com/macros/s/AKfycbw-01aF6V5ZEcJz6RB3CPQRiEfhi38qEqV1ELM5ix05shXut_R0A7RiU3XLn5GmlHLr/exec";

    // 탭 전환
    document.querySelectorAll('.tabbar button').forEach(btn=>{
      btn.addEventListener('click',()=>{
        document.querySelectorAll('.tabbar button').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        const tab = btn.dataset.tab;
        document.querySelectorAll('main section').forEach(s=>s.hidden = (s.id!==tab));
      })
    });

    // 토스트
    const toast=(msg)=>{const t=document.getElementById('toast');t.textContent=msg;t.style.display='block';setTimeout(()=>t.style.display='none',2400)}

    // 디버그 토글
    const dbg = document.getElementById('debugBox');
    document.getElementById('toggleDebug').addEventListener('click',()=>{
      dbg.style.display = dbg.style.display==='block' ? 'none' : 'block';
    });

    // 제출
    document.getElementById('introForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const form = e.currentTarget;
      const data = Object.fromEntries(new FormData(form).entries()); // 키=한국어 헤더
      const payload = {action:'create', ...data};
      try{
        const res = await fetch(GAS_URL, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify(payload)
        });
        const text = await res.text();
        let json; try{ json = JSON.parse(text); }catch(_){ json = {raw:text}; }
        dbg.textContent = 'POST 응답:\n' + JSON.stringify(json, null, 2);
        if(json?.result==='ok'){ toast('제출 완료!'); form.reset(); loadList(); }
        else { console.error(json); toast('저장 실패: ' + (json?.message || '응답 확인 필요')); }
      }catch(err){
        console.error(err); toast('제출 실패: 네트워크/GAS 설정 확인'); 
      }
    });

    // 목록 조회
    async function loadList(){
      try{
        const res = await fetch(`${GAS_URL}?action=read`);
        const text = await res.text();
        let json; try{ json = JSON.parse(text); }catch(_){ json = {raw:text}; }
        dbg.textContent = 'GET 응답:\n' + JSON.stringify(json, null, 2);
        const rows = Array.isArray(json?.rows)? json.rows: [];
        renderList(rows);
      }catch(err){
        console.error(err); toast('불러오기 실패: GAS 권한/CORS 확인');
      }
    }

    function renderList(rows){
      const team = document.getElementById('filterTeam').value?.trim();
      const name = document.getElementById('filterName').value?.trim();
      const filtered = rows.filter(r=>{
        const byTeam = team? String(r['편성 조']||'')===String(team): true;
        const byName = name? String(r['이름']||'').includes(name): true;
        return byTeam && byName;
      });
      const wrap = document.getElementById('list');
      wrap.innerHTML = '';
      if(filtered.length===0){wrap.innerHTML = '<p>아직 제출 데이터가 없어요.</p>';return}
      for(const r of filtered){
        const el = document.createElement('div');
        el.className='profile-card';
        el.innerHTML = `
          <h4>${r['이름']||''}<span class="pill">${r['편성 조']? r['편성 조']+'조':''}</span></h4>
          <div style="font-size:13px;line-height:1.5">
            <b>소속</b> ${r['소속 팀/센터/지점']||''}<br/>
            <b>MBTI</b> ${r['MBTI']||''} · <b>음주</b> ${r['음주량(소주기준)']||''} · <b>흡연</b> ${r['흡연 여부']||''}
          </div>
          <hr style="border:none;border-top:1px dashed #ffe0d5;margin:10px 0"/>
          <div><b>나이</b> ${r['나이']||''} · <b>고향/사는 곳</b> ${r['고향/사는 곳']||''}</div>
          <div><b>관심사</b> ${r['요즘 관심사']||''}</div>
          <div><b>취미</b> ${r['취미']||''}</div>
          <div><b>기쁨</b> ${r['근래 기뻤던 일']||''}</div>
          <div><b>슬픔</b> ${r['근래 슬펐던 일']||''}</div>
          <div><b>장점</b> ${r['성격 장점']||''}</div>
          <div><b>단점</b> ${r['성격 단점']||''}</div>
          <div><b>약속</b> ${r['조원들에게 약속']||''}</div>
        `;
        wrap.appendChild(el);
      }
    }
    document.getElementById('btnRefresh').addEventListener('click',()=>loadList());
    document.getElementById('filterTeam').addEventListener('input',()=>loadList());
    document.getElementById('filterName').addEventListener('input',()=>loadList());
    loadList();
  </script>
</body>
</html>
